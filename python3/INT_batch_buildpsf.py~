#!/usr/bin/env python

'''
GOAL: 
- create psf images for all the coadds

Run this from, e.g. /home/rfinn/data/reduced/psf-images/



'''

import os
import shutil
import glob
from astropy.io import fits
import matplotlib
matplotlib.use("Qt5agg")
homedir = os.getenv("HOME")
telescope = 'INT'
working_dir = os.getcwd()
coadd_image_directory = homedir+'/data/reduced/virgo-coadds-feb2019-int/'
# overwrite output files if they exist
overwrite = True

#print(flist1)



filters = ['r','Halpha','Ha6657']

for f in filters:
    # get list of current directory
    # this will grab the coadds but not the weight images
    flist1 = glob.glob(coadd_image_directory+'VF-*-'+f+'.fits')
    flist1.sort()
    for fimage in flist1: # loop through list

        print('##########################################')
        print('##########################################')        
        print('BUILDING PSF FOR: ',fimage)
        print('##########################################')
        print('##########################################')
    
        command_string = 'python ~/github/halphagui/testing/buildpsf.py --image {}'.format(fimage)
        # check to see if shifted r-band image exists.  if 
        try:
            print('running : ',command_string)
            os.system(command_string)
        except:
            print('##########################################')
            print('WARNING: problem running align_images for ',rimage)
            print('##########################################')

        # just running on one directory for testing purposes
        break
    break



